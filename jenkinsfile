pipeline {
  agent any
  tools {nodejs "Node_20"}
  parameters {
    string(name: 'Iteration_Count', defaultValue: '1', description: 'Number of iterations for Postman collection run')
  }
  stages {
    stage('Install Postman CLI') {
      steps {
        sh 'curl -o- "https://dl-cli.pstmn.io/install/linux64.sh" | sh'
      }
    }
    stage('Postman CLI Login') {
      steps {
        sh 'postman login --with-api-key $POSTMAN_API_KEY'
      }
    }
    stage('Running collection with iterations') {
      steps {
        sh 'postman collection run "37302476-23547b25-084c-4b30-bc78-9e72372dc9b8" --iteration-count ${params.Iteration_Count}'
      }
    }
  }
}